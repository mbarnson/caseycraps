---
phase: 02-table-dice
plan: 02
type: execute
domain: macos-apps
---

<objective>
Create dice sprites with satisfying rolling animation.

Purpose: Make dice rolling feel tactile and fun - the core interaction of the game.
Output: DieNode class with dot rendering and roll animation integrated into GameScene.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
@~/.claude/skills/create-plans/references/checkpoints.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@.planning/phases/02-table-dice/02-01-SUMMARY.md
@Casey Craps/Casey Craps/GameScene.swift
@Casey Craps/Casey Craps/CrapsTableNode.swift
@Casey Craps/Casey Craps/Models.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DieNode class with dot rendering</name>
  <files>Casey Craps/Casey Craps/DieNode.swift</files>
  <action>
Create DieNode.swift with an SKNode subclass that renders a die face:

1. DieNode class extending SKNode
2. Properties:
   - value: Int (1-6, default 1)
   - dieSize: CGFloat (about 60-80 points)
   - dieColor: SKColor (white or ivory)
   - dotColor: SKColor (black)

3. Die face rendering:
   - SKShapeNode rounded rect for the die body
   - SKShapeNode circles for dots
   - Standard dot patterns:
     * 1: center dot
     * 2: top-right, bottom-left diagonal
     * 3: diagonal + center
     * 4: four corners
     * 5: four corners + center
     * 6: two columns of three

4. Method setValue(_ newValue: Int) to update the displayed face
5. Private method layoutDots() that clears and redraws dots based on value

Keep it clean and readable - proper casino dice appearance.
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -10</verify>
  <done>DieNode.swift exists with dot rendering for values 1-6, builds without errors</done>
</task>

<task type="auto">
  <name>Task 2: Implement dice rolling animation</name>
  <files>Casey Craps/Casey Craps/DieNode.swift</files>
  <action>
Add rolling animation to DieNode:

1. Method roll(to finalValue: Int, completion: @escaping () -> Void):
   - Animate the die "tumbling" before settling on final value
   - Use SKAction sequence:
     * Quick scale pulse (excitement)
     * Rapid value changes (simulating tumble) - cycle through random values
     * Settle animation (slight bounce/scale)
     * Set final value
     * Call completion

2. Animation timing:
   - Total duration: about 1-1.5 seconds
   - Value cycling: 6-8 rapid changes over 0.8 seconds
   - Settle: 0.3 second ease-out

3. Use SKAction.run to change values during animation
4. Add slight rotation wobble for visual interest

Do NOT use SpriteKit physics - we control the outcome, animation is just visual flair.
The finalValue is predetermined by Die.roll() in the model.
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -10</verify>
  <done>DieNode has roll animation that cycles values and settles on final, builds without errors</done>
</task>

<task type="auto">
  <name>Task 3: Integrate dice into GameScene</name>
  <files>Casey Craps/Casey Craps/GameScene.swift</files>
  <action>
Update GameScene to use visual dice:

1. Add properties:
   - die1: DieNode
   - die2: DieNode
   - isRolling: Bool (prevent multiple simultaneous rolls)

2. In didMove(to:):
   - Create two DieNode instances
   - Position them in a "shooter area" (right side of table or designated spot)
   - Add them to the scene

3. Update mouseDown roll handling:
   - Guard against isRolling (prevent spam clicks)
   - Set isRolling = true
   - Get final values from Die.roll() (model)
   - Call die1.roll(to:) and die2.roll(to:) with those values
   - In completion handler: set isRolling = false, print total to console

4. Position roll button appropriately (not overlapping dice or table)

Result: Clicking roll shows animated dice that tumble and settle on random values.
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -10</verify>
  <done>Two dice visible in scene, roll button triggers animated dice roll</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Visual craps table with animated dice rolling</what-built>
  <how-to-verify>
    1. Run the app (Cmd+R in Xcode)
    2. Verify: Craps table layout visible (Pass Line, Don't Pass, point numbers)
    3. Verify: Two dice visible on/near the table
    4. Click Roll button
    5. Verify: Dice animate (tumble through values) then settle
    6. Verify: Animation feels satisfying (not too fast, not too slow)
    7. Click Roll multiple times - dice should show different results
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] xcodebuild build succeeds with no errors
- [ ] App launches without crashes
- [ ] Craps table visible with betting areas
- [ ] Two dice render correctly with dots
- [ ] Roll animation plays and completes
- [ ] Multiple rolls work without issues
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verified dice animation feels good
- Phase 2 complete: visual table and dice ready for game logic
</success_criteria>

<output>
After completion, create `.planning/phases/02-table-dice/02-02-SUMMARY.md`

This completes Phase 2. Ready for Phase 3: Game Logic.
</output>
