---
phase: 04-audio
plan: 01
type: execute
domain: macos-apps
---

<objective>
Create sound engine and implement core gameplay sounds.

Purpose: Add audio feedback that makes the game feel alive and tactile.
Output: SoundManager with dice rolling, chip clicking, and button feedback sounds.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@.planning/phases/03-game-logic/03-03-SUMMARY.md
@Casey Craps/Casey Craps/GameScene.swift
@Casey Craps/Casey Craps/DieNode.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SoundManager class with AVAudioEngine</name>
  <files>Casey Craps/Casey Craps/SoundManager.swift</files>
  <action>
Create SoundManager.swift with synthesized sound generation:

1. Import AVFoundation
2. SoundManager class as singleton (static let shared)
3. Properties:
   - audioEngine: AVAudioEngine
   - playerNode: AVAudioPlayerNode (or multiple for overlapping sounds)
   - isEnabled: Bool (allow muting)

4. Setup method called on init:
   - Create AVAudioEngine
   - Create AVAudioPlayerNode
   - Connect playerNode to mainMixerNode
   - Start engine

5. Core synthesis method:
   - playTone(frequency: Double, duration: Double, volume: Float)
   - Generate sine wave samples at given frequency
   - Use AVAudioPCMBuffer with float samples
   - Schedule buffer on playerNode

6. Helper to generate sine wave samples:
   - sampleRate: 44100
   - Calculate samples: sin(2 * pi * frequency * t / sampleRate)
   - Apply simple envelope (attack/release) to avoid clicks

Keep it simple - we just need basic beeps and clicks, not a full synthesizer.
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -10</verify>
  <done>SoundManager.swift exists with AVAudioEngine setup and playTone method</done>
</task>

<task type="auto">
  <name>Task 2: Implement dice rolling sound</name>
  <files>Casey Craps/Casey Craps/SoundManager.swift, Casey Craps/Casey Craps/DieNode.swift</files>
  <action>
1. In SoundManager, add dice rolling sound:
   - Method: playDiceRoll()
   - Create rapid sequence of short clicks/taps
   - Use noise bursts or rapid alternating tones (300-600 Hz range)
   - Duration: match dice animation (~1 second of rattling)
   - Taper off toward end as dice "settle"

2. Implementation approach:
   - Schedule multiple short tone bursts in sequence
   - Randomize frequencies slightly for organic feel
   - Or use white noise bursts (random samples) for more realistic rattle

3. In DieNode.roll(), call SoundManager.shared.playDiceRoll() when animation starts

4. Keep volume moderate - shouldn't be jarring
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -10</verify>
  <done>Dice rolling triggers rattling sound effect during animation</done>
</task>

<task type="auto">
  <name>Task 3: Implement chip and button sounds</name>
  <files>Casey Craps/Casey Craps/SoundManager.swift, Casey Craps/Casey Craps/GameScene.swift</files>
  <action>
1. In SoundManager, add chip click sound:
   - Method: playChipClick()
   - Short, satisfying click (high frequency ~1000-2000 Hz)
   - Very short duration (~50ms)
   - Like poker chip hitting felt

2. In SoundManager, add button click sound:
   - Method: playButtonClick()
   - Subtle UI feedback sound
   - Different tone than chip (lower, softer)
   - ~30-50ms duration

3. In GameScene:
   - When bet is placed (chip created), call playChipClick()
   - When roll button is clicked, call playButtonClick()

4. Sounds should be subtle and satisfying, not annoying
   - Test with repeated clicks - should not fatigue the ear
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -10</verify>
  <done>Chip placement and roll button trigger appropriate click sounds</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] xcodebuild build succeeds with no errors
- [ ] SoundManager.swift exists with AVAudioEngine setup
- [ ] playTone method generates audible sound
- [ ] Dice roll triggers rattling sound
- [ ] Chip placement triggers click sound
- [ ] Roll button triggers click sound
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No compiler errors
- Sounds play at appropriate times
</success_criteria>

<output>
After completion, create `.planning/phases/04-audio/04-01-SUMMARY.md`
</output>
