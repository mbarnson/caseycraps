---
phase: 05-polish
plan: 03
type: execute
domain: macos-apps
---

<objective>
Add Place bets on point numbers during point phase.

Purpose: Allow betting on individual numbers (4, 5, 6, 8, 9, 10) after point is established - core craps feature.
Output: Clickable point numbers for Place bets, proper odds payouts, complete craps betting experience.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
@~/.claude/skills/create-plans/references/checkpoints.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@Casey Craps/Casey Craps/GameScene.swift
@Casey Craps/Casey Craps/GameManager.swift
@Casey Craps/Casey Craps/Models.swift
@Casey Craps/Casey Craps/CrapsTableNode.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Place bet data model and GameManager support</name>
  <files>Casey Craps/Casey Craps/Models.swift, Casey Craps/Casey Craps/GameManager.swift</files>
  <action>
1. In Models.swift, extend BetType enum:
   - Add: case place(number: Int) for place bets on 4, 5, 6, 8, 9, 10

2. In Models.swift, add Place bet odds calculation:
   - Create function placeBetPayout(number: Int, betAmount: Int) -> Int
   - 6 and 8 pay 7:6 (bet $30, win $35)
   - 5 and 9 pay 7:5 (bet $25, win $35)
   - 4 and 10 pay 9:5 (bet $25, win $45)
   - For simplicity, we can round to nearest dollar

3. In Player class:
   - Change currentBet to array: var placeBets: [Bet] = []
   - Keep currentBet for Pass/Don't Pass line bet
   - Add method: placePlaceBet(number: Int, amount: Int) -> Bool
   - Add method: resolvePlaceBets(rolledNumber: Int, sevenOut: Bool) -> Int
     * Returns total winnings from place bets
     * If number hit: pay that bet and remove it
     * If seven out: lose all place bets

4. In GameManager:
   - Track place bets through player
   - Method: canPlaceBet(on number: Int) -> Bool
     * Only during .point phase
     * Not on the current point number
   - Update roll() to resolve place bets when numbers hit or seven out
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -10</verify>
  <done>Place bet model exists, GameManager can track and resolve place bets</done>
</task>

<task type="auto">
  <name>Task 2: Make point numbers clickable for Place bets</name>
  <files>Casey Craps/Casey Craps/CrapsTableNode.swift, Casey Craps/Casey Craps/GameScene.swift</files>
  <action>
1. In CrapsTableNode:
   - Give each point number box a name: "placeNumber4", "placeNumber5", etc.
   - Add method: highlightPlaceableNumbers(except point: Int)
     * Visually indicate which numbers can be bet on
     * Dim or disable the point number
   - Add method: clearPlaceHighlights()

2. In GameScene mouseDown:
   - Detect clicks on point number boxes during .point phase
   - If clicked number is not the current point:
     * Place bet using selected bet amount
     * Show chip on that number
     * Play chip click sound
     * Update bankroll display
   - If clicked number IS the point: ignore or show feedback

3. Visual feedback for place bets:
   - Show chip on each number that has a place bet
   - Track chips: var placeChips: [Int: SKNode] = [:] (number -> chip node)
   - Remove chips when bets resolve (win or seven out)
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -10</verify>
  <done>Point numbers are clickable, chips appear on bet numbers</done>
</task>

<task type="auto">
  <name>Task 3: Resolve Place bets and update UI</name>
  <files>Casey Craps/Casey Craps/GameScene.swift</files>
  <action>
1. When a number is rolled during point phase:
   - Check if player has place bet on that number
   - If yes: pay winnings, remove chip, show win feedback
   - Update bankroll display

2. On seven out:
   - All place bets lose
   - Remove all place chips from table
   - Bankroll already reduced when bets were placed

3. Update hints to mention place bets:
   - During point phase add: "Click numbers to place bets"
   - Or show available place bet numbers

4. When game resets:
   - Clear all place chips
   - Clear place bets array

5. Winnings display:
   - When place bet wins, briefly show winnings amount
   - Example: "+$35" floating up from the number
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -10</verify>
  <done>Place bets resolve correctly, winnings shown, chips cleared on seven out</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete craps with Pass/Don't Pass AND Place bets</what-built>
  <how-to-verify>
    1. Run the app
    2. Place Pass Line bet, roll until point is established (e.g., point is 6)
    3. During point phase, click on OTHER numbers (4, 5, 8, 9, 10)
       - Chips should appear on those numbers
       - Bankroll should decrease
       - Should NOT be able to click on the point number (6)
    4. Keep rolling:
       - If you hit a place bet number: should win and show payout
       - If you hit the point: Pass line wins, place bets stay? (depends on preference)
       - If you seven out: all bets lose (Pass line AND place bets)
    5. Verify payouts feel right (place bets pay odds)
    6. Does this feel like complete craps now?
  </how-to-verify>
  <resume-signal>Type "approved" if complete, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] xcodebuild build succeeds
- [ ] Can place bets on numbers during point phase
- [ ] Cannot place bet on the point number itself
- [ ] Place bets pay correct odds when hit
- [ ] Place bets lose on seven out
- [ ] Chips display correctly on numbers
- [ ] Bankroll updates correctly
</verification>

<success_criteria>
- All tasks completed
- Human verified Place bets work correctly
- Game feels like complete craps experience
</success_criteria>

<output>
After completion, create `.planning/phases/05-polish/05-03-SUMMARY.md`
</output>
