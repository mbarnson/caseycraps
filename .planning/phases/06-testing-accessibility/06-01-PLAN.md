---
phase: 06-testing-accessibility
plan: 01
type: execute
domain: macos-apps
---

<objective>
Set up test infrastructure and implement comprehensive GameManager unit tests.

Purpose: Establish testing foundation and verify core game logic is correct and won't regress.
Output: Working test target with GameManager tests covering all state transitions and craps rules.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@Casey Craps/Casey Craps/GameManager.swift
@Casey Craps/Casey Craps/Models.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create test target in Xcode project</name>
  <files>Casey Craps/Casey Craps.xcodeproj/project.pbxproj, Casey Craps/Casey CrapsTests/Casey_CrapsTests.swift</files>
  <action>
    Add a new unit test target "Casey CrapsTests" to the Xcode project. This requires:
    1. Create Casey CrapsTests directory with initial test file
    2. Modify project.pbxproj to add the test target, build phases, and link to main target

    Use Ruby/PlistBuddy or manual pbxproj editing. The test file should import XCTest and @testable import Casey_Craps.

    Include a simple placeholder test that always passes to verify the target works.
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" -destination 'platform=macOS' test 2>&1 | grep -E "(Test Suite|passed|failed)"</verify>
  <done>Test target exists, xcodebuild test runs successfully, placeholder test passes</done>
</task>

<task type="auto">
  <name>Task 2: Implement GameManager state machine tests</name>
  <files>Casey Craps/Casey CrapsTests/GameManagerTests.swift</files>
  <action>
    Create comprehensive tests for GameManager state transitions:

    1. Test initial state is .waitingForBet
    2. Test transition to .comeOut when bet placed
    3. Test come-out roll outcomes:
       - 7 or 11 → wins (Pass), loses (Don't Pass)
       - 2, 3, 12 → loses (Pass), wins/push (Don't Pass - 12 is push)
       - 4, 5, 6, 8, 9, 10 → establishes point, state becomes .point(N)
    4. Test point phase outcomes:
       - Roll matches point → Pass wins, Don't Pass loses
       - Roll is 7 → Pass loses (seven-out), Don't Pass wins
       - Other rolls → no resolution, stay in point phase

    Use @testable import to access internal state. Create helper method to set up GameManager with known state.
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" -destination 'platform=macOS' test 2>&1 | grep "GameManagerTests"</verify>
  <done>All state transition tests pass, covers come-out and point phase logic</done>
</task>

<task type="auto">
  <name>Task 3: Implement GameManager betting integration tests</name>
  <files>Casey Craps/Casey CrapsTests/GameManagerTests.swift</files>
  <action>
    Add tests for bet resolution and Place bet handling:

    1. Test Pass line bet payout (1:1)
    2. Test Don't Pass bet payout (1:1)
    3. Test Place bet odds:
       - 6 and 8 pay 7:6
       - 5 and 9 pay 7:5
       - 4 and 10 pay 9:5
    4. Test Place bets are returned (not lost) when point is hit
    5. Test Place bets are lost on seven-out
    6. Test that bets cannot be placed in invalid states

    Verify payout calculations match casino rules exactly.
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" -destination 'platform=macOS' test 2>&1 | grep -E "(testPlace|testPayout|passed)"</verify>
  <done>All betting tests pass, Place bet odds verified correct</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild test` runs without errors
- [ ] All GameManager tests pass
- [ ] Test coverage includes all game states
- [ ] Place bet odds verified against casino rules
</verification>

<success_criteria>
- Test target successfully added to project
- 15+ unit tests for GameManager
- All tests pass
- State machine logic fully covered
- Bet resolution logic fully covered
</success_criteria>

<output>
After completion, create `.planning/phases/06-testing-accessibility/06-01-SUMMARY.md`
</output>
