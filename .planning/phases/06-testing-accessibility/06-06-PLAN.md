---
phase: 06-testing-accessibility
plan: 06
type: execute
domain: macos-apps
---

<objective>
Add Reduce Motion support and clean up broken SKNode accessibility code.

Purpose: Respect user motion preferences and remove non-functional code.
Output: All animations have Reduce Motion alternatives, codebase is clean.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
@~/.claude/skills/create-plans/references/checkpoints.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@.planning/phases/06-testing-accessibility/06-05-SUMMARY.md
@Casey Craps/Casey Craps/DieNode.swift
@Casey Craps/Casey Craps/CrapsTableNode.swift
@Casey Craps/Casey Craps/GameScene.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Reduce Motion support</name>
  <files>Casey Craps/Casey Craps/DieNode.swift, Casey Craps/Casey Craps/CrapsTableNode.swift, Casey Craps/Casey Craps/GameScene.swift</files>
  <action>
    Respect the system Reduce Motion accessibility setting throughout the app:

    1. Create a helper property (in GameScene or as global):
       ```swift
       var shouldReduceMotion: Bool {
           return NSWorkspace.shared.accessibilityDisplayShouldReduceMotion
       }
       ```

    2. In DieNode.roll(to:completion:):
       ```swift
       func roll(to finalValue: Int, completion: @escaping () -> Void) {
           if NSWorkspace.shared.accessibilityDisplayShouldReduceMotion {
               // Immediate result, no animation
               setValue(finalValue)
               SoundManager.shared.playDiceRoll()  // Sound still plays
               completion()
               return
           }
           // ... existing tumble animation code ...
       }
       ```

    3. In DieNode.setGlowing(_:):
       ```swift
       func setGlowing(_ glowing: Bool) {
           if NSWorkspace.shared.accessibilityDisplayShouldReduceMotion {
               // Static gold border instead of pulse
               if glowing {
                   dieBody.strokeColor = SKColor(red: 0.9, green: 0.75, blue: 0.2, alpha: 1.0)
                   dieBody.lineWidth = 4
               } else {
                   dieBody.strokeColor = SKColor(white: 0.3, alpha: 1.0)
                   dieBody.lineWidth = 2
               }
               return
           }
           // ... existing pulse animation code ...
       }
       ```

    4. In CrapsTableNode.highlightBettingAreas(_:):
       ```swift
       func highlightBettingAreas(_ highlight: Bool) {
           if NSWorkspace.shared.accessibilityDisplayShouldReduceMotion {
               // Static brighter border instead of pulse
               passLineArea?.lineWidth = highlight ? 5 : 3
               dontPassArea?.lineWidth = highlight ? 4 : 2
               return
           }
           // ... existing pulse animation code ...
       }
       ```

    5. In CrapsTableNode.highlightPlaceNumbers(except:):
       - Similar: static highlight instead of pulse

    6. In CrapsTableNode.setPuckPosition(point:):
       - If reduce motion: instant position change instead of animated move

    7. In GameScene visual feedback (showWinFeedback, showLoseFeedback, showPointEstablished):
       - If reduce motion: instant color change, no fade animations
       - Still show the feedback, just without motion
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -5</verify>
  <done>All animations check shouldReduceMotion, static alternatives work correctly</done>
</task>

<task type="auto">
  <name>Task 2: Remove broken SKNode accessibility code</name>
  <files>Casey Craps/Casey Craps/DieNode.swift, Casey Craps/Casey Craps/CrapsTableNode.swift</files>
  <action>
    Remove the non-functional accessibility code that was setting properties on SKNodes:

    1. In DieNode.swift, remove:
       - setupAccessibility() method
       - updateAccessibility() method
       - All isAccessibilityElement, accessibilityRole, accessibilityLabel, accessibilityHelp assignments
       - Calls to setupAccessibility() and updateAccessibility()
       - Any isRollable property if it was only used for accessibility

    2. In CrapsTableNode.swift, remove:
       - All isAccessibilityElement assignments on SKShapeNodes
       - All accessibilityRole assignments on SKShapeNodes
       - All accessibilityLabel assignments on SKShapeNodes
       - All accessibilityHelp assignments on SKShapeNodes
       - updateBetAreaAccessibility() method if it exists
       - updatePointBoxAccessibility() method if it exists

    3. In GameScene.swift, KEEP:
       - announceRollResult() method (uses NSAccessibility.post - this works)
       - announceBetPlaced() method
       - announceBetResolved() method
       - updateTableAccessibility() can be removed if it only called CrapsTableNode methods

    These SKNode properties were never read by VoiceOver because SKNode doesn't conform to NSAccessibility.
    The new AccessibleSKView + NSAccessibilityElement approach replaces this functionality correctly.
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build && xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" -destination 'platform=macOS' test 2>&1 | grep -E "(passed|failed)"</verify>
  <done>Broken accessibility code removed, app builds, all tests pass</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Reduce Motion support and cleanup of broken accessibility code</what-built>
  <how-to-verify>
    **Test Reduce Motion:**
    1. System Settings → Accessibility → Display → Reduce Motion → ON
    2. Build and run the app (may need to restart app after changing setting)
    3. Verify dice roll shows final value immediately (no tumble animation)
    4. Verify dice glow is static gold border (no pulse)
    5. Verify Pass Line/Don't Pass highlights are static (no pulse)
    6. Verify point numbers highlight is static (no pulse)
    7. Verify puck moves instantly (no slide animation)
    8. Verify win/lose feedback appears but doesn't animate
    9. Turn OFF Reduce Motion when done

    **Verify accessibility still works:**
    10. Enable VoiceOver (Cmd+F5)
    11. Navigate with VO+arrows - all elements should still be announced
    12. Place bets and roll - announcements should work
    13. Disable VoiceOver

    **Verify app functionality:**
    14. Play a few complete rounds of craps
    15. Verify all game mechanics still work
    16. Verify sounds still play

    **Final verification:**
    17. All 99 unit tests should still pass
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild build` succeeds
- [ ] `xcodebuild test` - all 99 tests pass
- [ ] Reduce Motion setting is respected
- [ ] All animations have static alternatives
- [ ] Broken SKNode accessibility code removed
- [ ] VoiceOver still works correctly
- [ ] Game is fully playable
</verification>

<success_criteria>
- Reduce Motion fully supported
- Static alternatives for all animations
- No non-functional accessibility code remaining
- All existing tests pass
- VoiceOver accessibility works via AccessibleSKView
- User confirms all features work correctly
- Phase 6 complete
</success_criteria>

<output>
After completion, create `.planning/phases/06-testing-accessibility/06-06-SUMMARY.md`

Update ROADMAP.md to mark Phase 6 complete.
</output>
