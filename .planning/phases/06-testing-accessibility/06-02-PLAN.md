---
phase: 06-testing-accessibility
plan: 02
type: execute
domain: macos-apps
---

<objective>
Implement unit tests for Models (Player, Bet) and SoundManager logic.

Purpose: Ensure data models and audio synthesis logic are correct and testable.
Output: Comprehensive test coverage for Player bankroll operations, Bet lifecycle, and SoundManager parameters.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@.planning/phases/06-testing-accessibility/06-01-SUMMARY.md
@Casey Craps/Casey Craps/Models.swift
@Casey Craps/Casey Craps/SoundManager.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Player model tests</name>
  <files>Casey Craps/Casey CrapsTests/PlayerTests.swift</files>
  <action>
    Create tests for Player class:

    1. Test initial bankroll is set correctly
    2. Test placeBet deducts from bankroll
    3. Test placeBet fails when insufficient funds (returns false or throws)
    4. Test winBet adds correct amount to bankroll
    5. Test returnBet returns original bet amount (for Place bet take-down)
    6. Test bankroll cannot go negative
    7. Test multiple bets can be tracked simultaneously

    Verify edge cases: zero bets, exact bankroll bets, negative amounts rejected.
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" -destination 'platform=macOS' test 2>&1 | grep "PlayerTests"</verify>
  <done>All Player tests pass, bankroll operations verified correct</done>
</task>

<task type="auto">
  <name>Task 2: Implement Bet and BetType tests</name>
  <files>Casey Craps/Casey CrapsTests/BetTests.swift</files>
  <action>
    Create tests for Bet struct and BetType enum:

    1. Test BetType cases: .pass, .dontPass, .place(Int)
    2. Test Bet creation with amount and type
    3. Test Place bet payout calculation method:
       - .place(6) with $12 bet → $14 payout (7:6)
       - .place(8) with $12 bet → $14 payout (7:6)
       - .place(5) with $10 bet → $14 payout (7:5)
       - .place(9) with $10 bet → $14 payout (7:5)
       - .place(4) with $10 bet → $18 payout (9:5)
       - .place(10) with $10 bet → $18 payout (9:5)
    4. Test invalid Place numbers are rejected (not 4,5,6,8,9,10)
    5. Test bet equality and hashing if applicable

    Ensure fractional payouts round correctly (casino rules: round down).
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" -destination 'platform=macOS' test 2>&1 | grep "BetTests"</verify>
  <done>All Bet/BetType tests pass, payout calculations verified against casino odds</done>
</task>

<task type="auto">
  <name>Task 3: Implement SoundManager logic tests</name>
  <files>Casey Craps/Casey CrapsTests/SoundManagerTests.swift</files>
  <action>
    Create tests for SoundManager synthesis parameters (not actual audio playback):

    1. Test frequency calculations are in audible range (20Hz - 20kHz)
    2. Test win fanfare uses ascending tones
    3. Test lose sound uses descending tones
    4. Test dice roll sound parameters are reasonable
    5. Test chip click sound is short duration
    6. Test volume levels are within 0.0-1.0 range

    Note: Don't test actual AVAudioEngine playback (that's Apple's code).
    Test the logic/parameters that control sound generation.

    If SoundManager doesn't expose testable parameters, refactor to extract
    a SoundParameters struct or similar that can be unit tested.
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" -destination 'platform=macOS' test 2>&1 | grep "SoundManagerTests"</verify>
  <done>SoundManager logic tests pass, synthesis parameters verified reasonable</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `xcodebuild test` runs without errors
- [ ] All model tests pass
- [ ] Place bet odds match casino rules exactly
- [ ] SoundManager parameters are testable and tested
</verification>

<success_criteria>
- 10+ tests for Player model
- 8+ tests for Bet/BetType
- 5+ tests for SoundManager logic
- All tests pass
- No regressions in GameManager tests from Plan 1
</success_criteria>

<output>
After completion, create `.planning/phases/06-testing-accessibility/06-02-SUMMARY.md`
</output>
