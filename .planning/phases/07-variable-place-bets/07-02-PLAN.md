# Phase 7 Plan 02: Persistent Bet Amount Selector

## Goal

Keep the bet amount buttons ($25, $50, $100, $500) visible at all times for UI consistency and accessibility. This helps users build a mental model of the interface and allows keyboard/VoiceOver users to always locate the bet amount selector.

## Problem

Currently, bet buttons disappear during come-out phase:
- `waitingForBet` → visible
- `comeOut` → **hidden** (problem!)
- `point` → visible
- `resolved` → hidden

This creates confusion: "Where did those buttons go? How do I change my bet amount?"

## Solution

**Always show bet buttons**, but visually indicate when they're not actionable:

| State | Buttons | Appearance | Keyboard Focusable |
|-------|---------|------------|-------------------|
| `waitingForBet` | Active | Normal styling, selected highlighted | Yes |
| `comeOut` | Visible but disabled | Grayed out, muted | No (skip in tab order) |
| `point` | Active | Normal styling, selected highlighted | Yes |
| `resolved` | Visible but disabled | Grayed out, muted | No |

## Design Principles

1. **Spatial consistency**: UI elements stay in the same place
2. **State indication**: Disabled items look different but remain visible
3. **Keyboard efficiency**: Tab skips disabled elements
4. **VoiceOver clarity**: Disabled buttons announce as "dimmed" per Apple HIG

## Implementation

### Update `updateBetButtonStates()` in GameScene.swift

```swift
private func updateBetButtonStates() {
    let amounts = [25, 50, 100, 500]
    let bankroll = gameManager.player.bankroll
    let isWaitingForBet = gameManager.state == .waitingForBet
    let isPointPhase: Bool
    if case .point = gameManager.state { isPointPhase = true } else { isPointPhase = false }

    // Buttons are actionable during waitingForBet and point phases
    let buttonsActive = isWaitingForBet || isPointPhase

    for (index, amount) in amounts.enumerated() {
        if index < betButtons.count, let button = betButtons[index] as? SKShapeNode {
            let canAfford = bankroll >= amount
            let isSelected = amount == selectedBetAmount

            // Always show buttons (never hidden)
            button.isHidden = false

            if !buttonsActive {
                // Disabled state: grayed out during comeOut and resolved
                button.fillColor = SKColor(white: 0.2, alpha: 0.4)
                button.strokeColor = SKColor(white: 0.4, alpha: 0.4)
                button.lineWidth = 1
                if let label = button.children.first as? SKLabelNode {
                    label.fontColor = SKColor(white: 0.5, alpha: 0.6)
                }
            } else if !canAfford {
                // Can't afford: grayed but slightly more visible than disabled
                button.fillColor = SKColor(white: 0.3, alpha: 0.5)
                button.strokeColor = SKColor(white: 0.5, alpha: 0.5)
                button.lineWidth = 2
                if let label = button.children.first as? SKLabelNode {
                    label.fontColor = SKColor(white: 0.7, alpha: 1.0)
                }
            } else if isSelected {
                // Selected: gold highlight
                button.fillColor = SKColor(red: 0.8, green: 0.6, blue: 0.0, alpha: 1.0)
                button.strokeColor = .yellow
                button.lineWidth = 4
                if let label = button.children.first as? SKLabelNode {
                    label.fontColor = .white
                }
            } else {
                // Normal: blue
                button.fillColor = SKColor(red: 0.2, green: 0.2, blue: 0.8, alpha: 0.8)
                button.strokeColor = .white
                button.lineWidth = 2
                if let label = button.children.first as? SKLabelNode {
                    label.fontColor = .white
                }
            }
        }
    }
}
```

### Update `getActionableElements()` in GameScene.swift

Ensure bet buttons are only in the tab order when actionable:

```swift
private func getActionableElements() -> [FocusableElement] {
    var actionable: [FocusableElement] = []

    // Dice: actionable when can roll
    let canRoll: Bool
    if case .point = gameManager.state {
        canRoll = true
    } else {
        canRoll = gameManager.state == .comeOut
    }
    if canRoll && !isRolling {
        actionable.append(.dice)
    }

    // Bet buttons: only during waitingForBet and point phases
    let buttonsActive = gameManager.state == .waitingForBet || {
        if case .point = gameManager.state { return true }
        return false
    }()

    if buttonsActive {
        let bankroll = gameManager.player.bankroll
        let amounts = [25, 50, 100, 500]
        for amount in amounts {
            if bankroll >= amount, let element = FocusableElement.fromBetAmount(amount) {
                actionable.append(element)
            }
        }
    }

    // Pass Line / Don't Pass: only during waitingForBet
    if gameManager.state == .waitingForBet {
        actionable.append(.passLine)
        actionable.append(.dontPass)
    }

    // Point numbers: only during point phase
    if case .point(let currentPoint) = gameManager.state {
        let pointNumbers = [4, 5, 6, 8, 9, 10]
        for num in pointNumbers {
            if num != currentPoint {
                if let element = FocusableElement.fromPointNumber(num) {
                    actionable.append(element)
                }
            }
        }
    }

    return actionable
}
```

### Update hint text during come-out

In `updateHintLabel()`, no change needed - the hint already focuses on the roll. The visible-but-disabled buttons serve as a spatial anchor without needing explanation.

## Verification Checklist

- [ ] Bet buttons visible in ALL game states
- [ ] Buttons grayed/muted during comeOut and resolved states
- [ ] Buttons not keyboard-focusable when disabled
- [ ] Buttons active and styled correctly during waitingForBet
- [ ] Buttons active and styled correctly during point phase
- [ ] Selected amount remains highlighted across state transitions
- [ ] VoiceOver skips disabled buttons (not in tab order)

## Files to Modify

1. `Casey Craps/Casey Craps/GameScene.swift`
   - `updateBetButtonStates()` - always show, style based on state
   - `getActionableElements()` - already correct (only adds during active states)

## Accessibility Notes

- Disabled buttons remain visible for spatial consistency
- They're removed from keyboard navigation when not actionable
- This follows Apple HIG for disabled controls: "visible but dimmed"
