---
phase: 03-game-logic
plan: 01
type: execute
domain: macos-apps
---

<objective>
Implement betting system with clickable betting areas.

Purpose: Allow player to place Pass/Don't Pass bets before rolling.
Output: Clickable betting areas, bet tracking, chip display on table.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@.planning/phases/02-table-dice/02-02-SUMMARY.md
@Casey Craps/Casey Craps/GameScene.swift
@Casey Craps/Casey Craps/GameManager.swift
@Casey Craps/Casey Craps/Models.swift
@Casey Craps/Casey Craps/CrapsTableNode.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Player to GameManager and display bankroll</name>
  <files>Casey Craps/Casey Craps/GameManager.swift, Casey Craps/Casey Craps/GameScene.swift</files>
  <action>
1. In GameManager:
   - Add property: let player = Player() (starts with $1000)
   - Make player accessible for UI to read bankroll

2. In GameScene:
   - Add bankroll display label (SKLabelNode) in top area of screen
   - Format as "$1,000" style
   - Update display when bankroll changes (can use simple refresh method for now)
   - Position in top-left or top-center, clearly visible

Keep it simple - just showing the number. Fancy HUD comes in Phase 5.
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -10</verify>
  <done>Player in GameManager, bankroll displays on screen showing $1,000</done>
</task>

<task type="auto">
  <name>Task 2: Make betting areas clickable</name>
  <files>Casey Craps/Casey Craps/CrapsTableNode.swift, Casey Craps/Casey Craps/GameScene.swift</files>
  <action>
1. In CrapsTableNode:
   - Give Pass Line area a name: "passLineArea"
   - Give Don't Pass area a name: "dontPassArea"
   - These names allow hit detection in GameScene

2. In GameScene mouseDown:
   - Check if clicked node name is "passLineArea" or "dontPassArea"
   - Only allow betting when gameManager.state == .waitingForBet
   - When betting area clicked:
     * Call player.placeBet(type: .pass or .dontPass, amount: 100)
     * Fixed $100 bet for simplicity (can add bet sizing in Polish phase)
     * Transition game state to .comeOut via gameManager.placeBet()
   - Disable roll button until bet is placed
   - Enable roll button after bet is placed

3. Visual feedback:
   - Change betting area color slightly when bet placed (highlight)
   - Or add a simple "BET PLACED" indicator
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -10</verify>
  <done>Clicking Pass Line or Don't Pass places bet when in waitingForBet state</done>
</task>

<task type="auto">
  <name>Task 3: Display bet chip on table</name>
  <files>Casey Craps/Casey Craps/GameScene.swift</files>
  <action>
1. Create a simple chip node:
   - SKShapeNode circle (about 40-50 points diameter)
   - Red or casino chip color
   - Optional: "$100" label on it

2. When bet is placed:
   - Create chip node
   - Position it on the betting area that was clicked
   - Add to scene (or to CrapsTableNode)

3. Store reference to chip so it can be removed later (after win/lose)
   - Property: var betChip: SKNode?

4. Update bankroll display after bet placed (should show $900 after $100 bet)

This gives visual confirmation that bet is placed and where.
  </action>
  <verify>xcodebuild -project "Casey Craps/Casey Craps.xcodeproj" -scheme "Casey Craps" build 2>&1 | tail -10</verify>
  <done>Chip appears on betting area when bet placed, bankroll updates to $900</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] xcodebuild build succeeds with no errors
- [ ] Bankroll displays on screen ($1,000 initially)
- [ ] Clicking Pass Line places bet and shows chip
- [ ] Clicking Don't Pass places bet and shows chip
- [ ] Bankroll updates after bet ($900)
- [ ] Can only bet when in waitingForBet state
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No compiler errors
- Player can place bets on Pass or Don't Pass
</success_criteria>

<output>
After completion, create `.planning/phases/03-game-logic/03-01-SUMMARY.md`
</output>
